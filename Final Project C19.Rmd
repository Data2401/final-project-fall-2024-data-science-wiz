---
title: "Final Project"
author: "Claudia Lopez & Vanessa Ortiz"
date: "2024-04-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(ggplot2) 
library(lubridate) #this package was used to separate the dates into separate columns
```

# Introduction 

As an evolving planet and ever-evolving society, one thing has left a mark on the world . Covid-19 caused detrimental effects reaching all sides of the globe.  In this data set, we take a dive into the relationship of covid- 19 and the negative toll that it took upon human health that is measured through deaths. We will visually showcase the pattern between the data sets, All while asking questions such as the correlation of covid-19 and how they varied throughout each continent.  Through these data sets we will have a greater understanding of the once critical problem that took the lives of many. 
 

# Questions

- What are the top 10 countries with the most covid-19 cases?
- What are the top 5 countries with the least covid-19 cases?
- What is the relationship between hospitalization and deaths from covid-19?
- Is there any correlation between the country population and covid-19 cases?
- When was the peak of the most cases for covid?  

```{r} 
#load in data
covid19_data <- read.csv("covid19.csv")
pop_data <- read.csv("population_by_country_2020.csv")

```


## Filtering the data 
```{r, message=FALSE}
#separating the date column into separate columns to filter better for each month
colnames(covid19_data)[1] <- "date" 
covid19_data$date <- as.Date(covid19_data$date)
c19_dd <- data.frame(date = covid19_data$date,
                              year = as.numeric(format(covid19_data$date, format = "%y")), 
                              month = as.numeric(format(covid19_data$date, format = "%m")), 
                              day = as.numeric(format(covid19_data$date, format = "%d")))

#joined the original dataset with the newly created dataset with the separated columns
new_covid19_data <- full_join(c19_dd, covid19_data, by = "date") 

#filtering to keep 'all states' for each country 
new_covid19_data <- new_covid19_data %>% filter(Province_State == "All States")

#removes any duplicated rows
Final_covid19_data <- new_covid19_data %>% distinct(month, day, Continent_Name,Country_Region, Province_State, positive, hospitalized, .keep_all = TRUE)

# this is to check to make sure the data was properly filtered
Final_covid19_data %>% filter(month == 2) %>% arrange(-positive) %>% head(10)
```

```{r}
#this section im trying to filter out the US Data 
new_covid19_data %>% filter(month == "2") %>% arrange(-positive) %>% select(month, Country_Region, positive)  %>% head(10)

US_data <- new_covid19_data %>% filter(Country_Region == "United States", Province_State == "All States")

US_data %>% arrange(-positive) %>% head(5)

#shows how many duplicated rows of each, in the knit file it prints out too long so i have marked it out for now
#US_data[!duplicated(US_data$day), ] 


US_data <- US_data %>% distinct(month,day, .keep_all = TRUE)
#this eliminates the duplicated rows based on month and day, as in it keeps one entry per day


```
# Question 1:
```{r}
#top 10 countries with most cases

Final_covid19_data %>% group_by(Country_Region) %>% summarize_at(vars(positive), list(max = max), na.rm = T) %>% arrange(-max) %>% head(10)

#Filtering data for the countries with the top 10 cases
top_10_countries <- Final_covid19_data %>% 
  group_by(Country_Region) %>% 
  summarize(total_cases = max(positive, na.rm = TRUE)) %>% 
  top_n(10, total_cases) %>% 
  arrange(desc(total_cases))

# Create the bar plot
ggplot(top_10_countries, aes(x = reorder(Country_Region, total_cases), y = total_cases)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Top 10 Countries with Most COVID-19 Cases",
       x = "Country",
       y = "Total Cases") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_flip()

#top 10 countries with most cases on average

Final_covid19_data %>% group_by(Country_Region) %>% summarize_at(vars(positive), list(mean = mean), na.rm = T) %>% arrange(-mean) %>% head(10)

# Filter the data to get the top 10 countries with the highest average cases
top_10_avg_countries <- Final_covid19_data %>%
  group_by(Country_Region) %>%
  summarize(mean_cases = mean(positive, na.rm = TRUE)) %>%
  top_n(10, mean_cases) %>%
  arrange(desc(mean_cases))

# Create the bar plot
ggplot(top_10_avg_countries, aes(x = reorder(Country_Region, mean_cases), y = mean_cases)) +
  geom_bar(stat = "identity", fill ="lightpink") +
  labs(title = "Top 10 Countries with Highest Average COVID-19 Cases",
       x = "Country",
       y = "Average Cases") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_flip()


```
# Question 2:
```{r}
#top 5 countries with least cases 

Final_covid19_data %>% group_by(Country_Region) %>% summarize_at(vars(positive), list(max = max), na.rm = T) %>% arrange(max) %>% head(5)

#Filtering data
top_5_least_countries <- Final_covid19_data %>%
  group_by(Country_Region) %>%
  summarize(total_cases = max(positive, na.rm = TRUE)) %>%
  arrange(total_cases) %>%
  head(5)

# Filter the data for the selected countries
top_5_least_data <- Final_covid19_data %>%
  filter(Country_Region %in% top_5_least_countries$Country_Region)

# Create the scatter plot
ggplot(top_5_least_data, aes(x = date, y = positive, color = Country_Region)) +
  geom_point() +
  labs(title = "Top 5 Countries with Least COVID-19 Cases",
       x = "Date",
       y = "Total Cases") +
  theme_minimal()
#top 10 countries with the least cases on average
Final_covid19_data %>% group_by(Country_Region) %>% summarize_at(vars(positive), list(mean = mean), na.rm = T) %>% arrange(mean) %>% head(10)

bottom_10_avg_countries <- Final_covid19_data %>%
  group_by(Country_Region) %>%
  summarize(mean_cases = mean(positive, na.rm = TRUE)) %>%
  top_n(10, -mean_cases) %>%
  arrange(mean_cases)

# Create the line plot
ggplot(bottom_10_avg_countries, aes(x = reorder(Country_Region, mean_cases), y = mean_cases)) +
  geom_line(color = "darkred") +
  geom_point(color = "darkred") +
  labs(title = "Top 10 Countries with Least Average COVID-19 Cases",
       x = "Country",
       y = "Average Cases") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
# Question 4: 
```{r}
# Merge COVID-19 data with population data
merged_data <- merge

```
# Question 5:
```{r}
#when was peak for most cases for most covid cases
most_cases_per_month <- Final_covid19_data %>% group_by(month, Continent_Name) %>% summarize_at(vars(positive), list(max = max), na.rm = T) %>% arrange(-max)

#graph 
ggplot(most_cases_per_month, aes(x = month, y = max, color = Continent_Name)) + geom_point(size = 3) 


# separated by continent
ggplot(most_cases_per_month, aes(x = month, y = max, color = Continent_Name)) + geom_point(size = 3) + facet_wrap(~ Continent_Name)
```



